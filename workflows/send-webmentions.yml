name: Send webmentions for new blog posts
on:
  rss:
    url: https://robbinespu.gitlab.io/indieweb/index.xml
    config:
      logLevel: debug
      limit: 10
jobs:
  send_webmentions:
    name: Send webmentions
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
    
      - name: "Send webmentions for RSS item link"
        uses: actionsflow/axios@v1
        with:
          url: https://webmention.app/check/
          method: "POST"
          params: '{ "url": "${{on.rss.outputs.link}}", "token": "${{ secrets.WM_TOKEN }}" }'
          is_debug: true
          
      - name: "Bridgy twitter"
        run: |
          curl -i \
          -d source=${{on.rss.outputs.link}} \
          -d target=https://brid.gy/publish/twitter \
          https://brid.gy/publish/webmention

      - name: "Bridgy mastodon"
        run: |
          curl -i \
          -d source=${{on.rss.outputs.link}} \
          -d target=https://brid.gy/publish/mastodon \
          https://brid.gy/publish/webmention

      - name: "Bridgy github"
        run: |
          curl -i \
          -d source=${{on.rss.outputs.link}} \
          -d target=https://brid.gy/publish/github \
          https://brid.gy/publish/webmention

      - name: "Bridgy flickr"
        run: |
          curl -i \
          -d source=${{on.rss.outputs.link}} \
          -d target=https://brid.gy/publish/flickr \
          https://brid.gy/publish/webmention



